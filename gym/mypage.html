<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>My Page</title>
    <link rel="stylesheet" href="design.css">
</head>
<body>
<style>
    * {
        box-sizing: border-box;
        font-family: 'Segoe UI', sans-serif;
    }

    body {
        margin: 0;
        background: #f4f6f9;
    }

    /* ì „ì²´ ì»¨í…Œì´ë„ˆ */
    .mypage-container {
        max-width: 1100px;
        margin: 0 auto;
        padding: 40px 20px;
    }

    /* í—¤ë” */
    .mypage-header {
        margin-bottom: 40px;
    }

    .mypage-header h1 {
        margin: 0;
        font-size: 32px;
    }

    .mypage-header p {
        color: #666;
    }

    /* ì¹´ë“œ ê·¸ë¦¬ë“œ */
    .card-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 20px;
    }

    /* ì¹´ë“œ */
    .card {
        background: white;
        padding: 25px;
        border-radius: 14px;
        box-shadow: 0 8px 20px rgba(0,0,0,0.08);
    }

    .card h3 {
        margin-top: 0;
        margin-bottom: 15px;
    }

    /* ê°•ì¡° í…ìŠ¤íŠ¸ */
    .highlight {
        font-size: 26px;
        font-weight: bold;
        color: #2a5298;
        margin-top: 10px;
    }

    .big-text {
        font-size: 14px;
        color: #666;
    }

    /* ìƒíƒœ */
    .success {
        color: #2ecc71;
        font-weight: bold;
        font-size: 18px;
    }

    /* ë²„íŠ¼ */
    button {
        width: 100%;
        padding: 12px;
        background: #2a5298;
        color: white;
        border: none;
        border-radius: 8px;
        font-weight: bold;
        cursor: pointer;
    }

    button:hover {
        background: #1e3c72;
    }

    /* ì•„ì›ƒë¼ì¸ ë²„íŠ¼ */
    button.outline {
        background: transparent;
        color: #2a5298;
        border: 2px solid #2a5298;
    }

    button.outline:hover {
        background: #2a5298;
        color: white;
    }
    .logout-area {
        text-align: center;
        margin-top: 40px;
    }

    .logout-btn {
        padding: 12px 30px;
        background: #e74c3c;
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 15px;
        font-weight: bold;
        cursor: pointer;
    }

    .logout-btn:hover {
        background: #c0392b;
    }

    #remain-days {
        font-weight: bold;
        color: #2a5298;
    }
    .highlight {
    letter-spacing: 4px;
}
/* ì‚¬ë¬¼í•¨ ì´ìš© ë¶ˆê°€ ê°•ì¡° ë©”ì‹œì§€ */
.locker-block {
    background: #fff5f5;
    border: 2px dashed #e74c3c;
    color: #e74c3c;
    font-weight: bold;
    font-size: 16px;
    padding: 18px;
    border-radius: 12px;
    text-align: center;
    pointer-events: none;
}
/* ì‚¬ë¬¼í•¨ ë²„íŠ¼ í´ë¦­ ë³´ì¥ */
#locker-area button {
    position: relative;
    z-index:20;
    pointer-events: auto;
}

</style>
<div class="mypage-container">

    <!-- ìƒë‹¨ -->
    <header class="mypage-header">
        <h1>My Page</h1>
        <p>íšŒì› ì •ë³´ ë° ì´ìš© í˜„í™©</p>
    </header>

    <!-- ì¹´ë“œ ì˜ì—­ -->
    <section class="card-grid">

        <!-- íšŒì› ì •ë³´ -->
        <div class="card">
            <h3>íšŒì› ì •ë³´</h3>
            <p><strong>ID</strong> : <span id="user-id"></span></p>
            <p><strong>ì´ë¦„</strong> : <span id="user-name"></span></p>
            <p><strong>ë“±ë¡ í˜„í™©</strong> : <span id="reg-status"></span></p>
            <p><strong>ë‚¨ì€ ê¸°ê°„</strong> : <span id="remain-days"></span></p>

        </div>

        <!-- ì‚¬ë¬¼í•¨ -->
        <div class="card">
            <h3>ì‚¬ë¬¼í•¨</h3>
            <div id="locker-area"></div>
        </div>

        <!-- ê²°ì œ -->
        <div class="card">
            <h3>ê²°ì œ ì •ë³´</h3>
            <div id="payment-area"></div>
        </div>

    </section>
</div>
<div class="logout-area">
    <button class="logout-btn" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
</div>

<script>
// ë¡œê·¸ì¸ ì²´í¬
if (localStorage.getItem("isLogin") !== "true") {
    alert("ë¡œê·¸ì¸ í›„ ì´ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.\në¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.");
    location.href = "login.html";
}
</script>

<script>
const loginId = localStorage.getItem("loginId");
const loginName = localStorage.getItem("loginUser");

document.getElementById("user-id").innerText = loginId;
document.getElementById("user-name").innerText = loginName;

/* ===== ê²°ì œ ì—¬ë¶€ ===== */
const paidKey = `isPaid_${loginId}`;
const paid = localStorage.getItem(paidKey);

/* ===== ë“±ë¡ í˜„í™© / ë‚¨ì€ ê¸°ê°„ ===== */
const regStatus = document.getElementById("reg-status");
const remainText = document.getElementById("remain-days");

if (paid === "true") {
    const expiresAtStr = localStorage.getItem(`expiresAt_${loginId}`);

    if (expiresAtStr) {
        const expiresAt = new Date(expiresAtStr);
        const today = new Date();
        const diffTime = expiresAt - today;
        const remainDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

        if (remainDays > 0) {
            regStatus.innerText = "ë“±ë¡ë¨";
            remainText.innerText = `${remainDays}ì¼ ë‚¨ì•˜ìŠµë‹ˆë‹¤.`;
        } else {
            regStatus.innerText = "ë§Œë£Œ";
            remainText.innerText = "ì´ìš© ê¸°ê°„ì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.";
        }
    } else {
        regStatus.innerText = "ë“±ë¡ì „";
        remainText.innerText = "-";
    }
} else {
    regStatus.innerText = "ë“±ë¡ì „";
    remainText.innerText = "-";
}

/* ===== ì‚¬ë¬¼í•¨ ===== */
const lockerArea = document.getElementById("locker-area");
const lockerKey = `lockerPw_${loginId}`;
const lockerPw = localStorage.getItem(lockerKey);

let canUseLocker = false;

// ê²°ì œ + ë§Œë£Œ ì—¬ë¶€ í™•ì¸
if (paid === "true") {
    const expiresAtStr = localStorage.getItem(`expiresAt_${loginId}`);

    if (expiresAtStr) {
        const expiresAt = new Date(expiresAtStr);
        const today = new Date();

        if (expiresAt > today) {
            canUseLocker = true;
        }
        else {
            /* ğŸ”¥ ë§Œë£Œ â†’ ì‚¬ë¬¼í•¨ ë¹„ë°€ë²ˆí˜¸ ì´ˆê¸°í™” */
            localStorage.removeItem(lockerKey);
        }
    }
}
function registerLocker() {
    const pw = prompt("ì‚¬ë¬¼í•¨ ë¹„ë°€ë²ˆí˜¸ 4ìë¦¬ë¥¼ ì…ë ¥í•˜ì„¸ìš”");
    if (pw && pw.length === 4 && !isNaN(pw)) {
        localStorage.setItem(`lockerPw_${loginId}`, pw);
        alert("ì‚¬ë¬¼í•¨ ë“±ë¡ ì™„ë£Œ");
        location.reload(); // ìƒˆë¡œê³ ì¹¨í•´ì„œ ë²„íŠ¼ + ë¹„ë°€ë²ˆí˜¸ ì˜ì—­ ê°±ì‹ 
    } else {
        alert("ìˆ«ì 4ìë¦¬ë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.");
    }
}

// âœ… ì‚¬ë¬¼í•¨ ì‚¬ìš© ê°€ëŠ¥
if (canUseLocker) {
    if (lockerPw) {
        lockerArea.innerHTML = `
            <p class="big-text">ë¹„ë°€ë²ˆí˜¸</p>
            <div class="highlight" id="locker-pw">â€¢â€¢â€¢â€¢</div>
            <button class="outline" onclick="toggleLockerPw()">ë³´ê¸°</button>
        `;
    } else {
        lockerArea.innerHTML = `
            <button class="outline" onclick="registerLocker()">ì‚¬ë¬¼í•¨ ë“±ë¡</button>
        `;
    }
}
// âŒ ì‚¬ë¬¼í•¨ ì‚¬ìš© ë¶ˆê°€
else {
    lockerArea.innerHTML = `
        <div class="locker-block">
            ğŸ”’ ê²°ì œ í›„ ì´ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤
        </div>
    `;
}


/* ===== ê²°ì œ ì˜ì—­ ===== */
const paymentArea = document.getElementById("payment-area");
let canUse =false;
if (paid === "true") {
    const expiresAtStr = localStorage.getItem(`expiresAt_${loginId}`);

    if (expiresAtStr) {
        const expiresAt = new Date(expiresAtStr);
        const today = new Date();

        if (expiresAt > today) {
            canUse = true;
        }
    }
}

if (canUse) {
    paymentArea.innerHTML = `<p class="success">ê²°ì œ ì™„ë£Œ</p>`;
} else {
    paymentArea.innerHTML = `
        <button onclick="location.href='payment.html'">ì˜¨ë¼ì¸ ê²°ì œ</button>
    `;
}

/* ===== ë¡œê·¸ì•„ì›ƒ ===== */
function logout() {
    localStorage.removeItem("isLogin");
    localStorage.removeItem("loginId");
    localStorage.removeItem("loginUser");

    alert("ë¡œê·¸ì•„ì›ƒë˜ì—ˆìŠµë‹ˆë‹¤.");
    location.href = "login.html";
}

/* ===== ì‚¬ë¬¼í•¨ ë¹„ë°€ë²ˆí˜¸ í† ê¸€ ===== */
let isPwVisible = false;

function toggleLockerPw() {
    const pwArea = document.getElementById("locker-pw");
    const btn = event.target;
    const lockerPw = localStorage.getItem(`lockerPw_${loginId}`);

    if (!isPwVisible) {
        pwArea.innerText = lockerPw;
        btn.innerText = "ìˆ¨ê¸°ê¸°";
    } else {
        pwArea.innerText = "â€¢â€¢â€¢â€¢";
        btn.innerText = "ë³´ê¸°";
    }

    isPwVisible = !isPwVisible;
}
</script>


</body>
</html>

